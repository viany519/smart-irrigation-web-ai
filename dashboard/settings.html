<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Greenpulse • Settings</title>
    <link rel="stylesheet" href="./styles.css" />
    <style>
      .page-head { display:flex; align-items:flex-end; justify-content:space-between; gap:16px; margin-bottom:14px; }
      .page-title { font-size:44px; line-height:1.1; margin:0; }
      .page-sub { margin:6px 0 0; color:#6b7280; }

      .wrap { display:grid; grid-template-columns: 1.3fr 1fr; gap:18px; margin-top:14px; }
      .card { background:rgba(255,255,255,.72); border:1px solid rgba(0,0,0,.08); border-radius:22px; box-shadow:0 16px 40px rgba(0,0,0,.06); overflow:hidden; }
      .card.pad { padding:18px; }

      .sec-title { margin:0 0 10px; font-size:18px; }
      .muted { color:#6b7280; font-size:13px; }
      .form { display:grid; gap:12px; margin-top:12px; }
      .row { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
      .field label { display:block; font-weight:700; margin-bottom:6px; }
      .field input, .field select {
        width:100%; padding:12px 14px; border-radius:14px;
        border:1px solid rgba(0,0,0,.12); background:#fff;
        outline:none;
      }

      .actions { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
      .btn { border:1px solid rgba(0,0,0,.12); background:#fff; padding:10px 14px; border-radius:999px; cursor:pointer; font-weight:800; }
      .btn.primary { background:#0f5a45; color:#fff; border-color:#0f5a45; }

      .kv { display:grid; gap:10px; margin-top:12px; }
      .kv .item { display:flex; justify-content:space-between; gap:10px; border:1px solid rgba(0,0,0,.08); border-radius:16px; padding:12px 14px; background:rgba(255,255,255,.75); }
      .kv .k { color:#6b7280; }
      .kv .v { font-weight:900; }

      @media (max-width: 980px) {
        .wrap { grid-template-columns: 1fr; }
        .page-title { font-size:36px; }
      }
    </style>
  </head>

  <body class="bg-grid-light" data-page="settings">
    <div class="shell">

      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="brand">
          <img src="./assets/logo.svg" alt="logo" />
          greenpulse
        </div>

        <div class="nav-title">MENU</div>
        <nav class="nav">
          <a href="./dashboard.html"><img class="icon" src="./assets/icons/dashboard.svg" />Dashboard</a>
          <a href="./monitoring.html"><img class="icon" src="./assets/icons/monitoring.svg" />Monitoring</a>
          <a href="./control.html"><img class="icon" src="./assets/icons/control.svg" />Control</a>
          <a href="./history.html"><img class="icon" src="./assets/icons/history.svg" />History</a>
          <a href="./settings.html" class="active"><img class="icon" src="./assets/icons/settings.svg" />Settings</a>
        </nav>

        <div class="nav-title">GENERAL</div>
        <nav class="nav">
          <a href="./profile.html"><img class="icon" src="./assets/icons/profile.svg" />Profile</a>
          <a href="./help.html"><img class="icon" src="./assets/icons/help.svg" />Help</a>
          <a href="#" data-logout>
            <img class="icon" src="./assets/icons/logout.svg" />
            Logout
        </a>

        </nav>
      </aside>

      <!-- MAIN -->
      <div class="main">

        <!-- TOPBAR -->
       <div class="topbar">
          <input class="search" placeholder="Search" />
          <a class="icon-btn" href="./notification.html" title="Notifications">
            <img
            src="./assets/icons/notification.png"
            alt="Notifications"
            class="notif-icon"
            />
          </a>

          <div class="profile">
            <img data-user-photo src="./assets/avatar-default.png" alt="avatar" />
            <div>
              <div class="name" data-user-name>User</div>
              <div class="email" data-user-email>user@email.com</div>
            </div>
          </div>
        </div>

        <!-- CONTENT -->
        <div class="content">
          <div class="page-head">
            <div>
              <h1 class="page-title">Settings</h1>
              <p class="page-sub">
                Atur parameter simulasi sensor dan aturan keputusan penyiraman tanaman.
              </p>
            </div>
          </div>

          <div class="wrap">
            <!-- LEFT -->
            <div class="card pad">
              <h3 class="sec-title">Decision rule</h3>
              <div class="muted">
                Aturan ini digunakan sistem untuk menentukan apakah tanaman
                perlu disiram berdasarkan nilai sensor yang kamu input secara manual.
              </div>

              <div class="form">
                <div class="row">
                  <div class="field">
                    <label for="moistTh">Moisture threshold</label>
                    <input id="moistTh" type="number" step="0.01" />
                    <div class="muted">
                      Batas nilai kelembapan tanah. Jika nilai berada di bawah angka ini,
                      sistem akan merekomendasikan penyiraman.
                    </div>
                  </div>
                  <div class="field">
                    <label for="probScale">Decision sensitivity</label>
                    <input id="probScale" type="number" step="0.1" />
                    <div class="muted">
                      Mengatur sensitivitas sistem dalam menampilkan tingkat keyakinan
                      keputusan penyiraman.
                    </div>
                  </div>
                </div>

                <h3 class="sec-title" style="margin-top: 6px">Sensor calibration</h3>
                <div class="muted">
                  Kalibrasi nilai minimum dan maksimum sensor kelembapan tanah
                  agar pembacaan sesuai dengan karakteristik alat yang digunakan.
                </div>

                <div class="row">
                  <div class="field">
                    <label for="rawMin">Dry soil value</label>
                    <input id="rawMin" type="number" step="1" />
                    <div class="muted">
                      Nilai sensor saat tanah berada dalam kondisi benar-benar kering.
                    </div>
                  </div>
                  <div class="field">
                    <label for="rawMax">Wet soil value</label>
                    <input id="rawMax" type="number" step="1" />
                    <div class="muted">
                      Nilai sensor saat tanah berada dalam kondisi basah.
                    </div>
                  </div>
                </div>

                <div class="actions">
                  <button class="btn primary" id="btnSave" type="button">Save</button>
                  <button class="btn" id="btnReset" type="button">Reset default</button>
                </div>
              </div>
            </div>

            <!-- RIGHT -->
            <div class="card pad">
              <h3 class="sec-title">Preview</h3>
              <div class="muted">
                Menampilkan ringkasan hasil keputusan terakhir berdasarkan data
                yang pernah kamu input sebelumnya.
              </div>

              <div class="kv">
                <div class="item"><div class="k">Last moisture</div><div class="v" id="pvMoist">—</div></div>
                <div class="item"><div class="k">Last temp</div><div class="v" id="pvTemp">—</div></div>
                <div class="item"><div class="k">Last humidity</div><div class="v" id="pvHum">—</div></div>
                <div class="item"><div class="k">Need water</div><div class="v" id="pvNeed">—</div></div>
                <div class="item"><div class="k">Prob</div><div class="v" id="pvProb">—</div></div>
              </div>

              <div style="height:14px"></div>

              <h3 class="sec-title">About</h3>
              <div class="muted">
                Halaman ini membantu menyesuaikan sistem dengan alat ukur yang kamu miliki,
                sehingga hasil prediksi kebutuhan air lebih relevan
                dengan kondisi tanaman di lapangan.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="./app.js"></script>
    <script>
document.addEventListener("DOMContentLoaded", () => {
  const session = JSON.parse(localStorage.getItem("gp_session") || "null");
  if (!session?.email) return;

  const email = session.email;
  const plantId =
    localStorage.getItem(`gp_active_plant_${email}`) ||
    JSON.parse(localStorage.getItem("gp_users") || "[]")
      .find(u => u.email === email)?.selectedPlantId;

  if (!plantId) return;

  const sensor = JSON.parse(
    localStorage.getItem(`gp_sensor_${email}_${plantId}`) || "null"
  );
  if (!sensor) return;

  // === ISI PREVIEW ===
  document.getElementById("pvMoist").textContent = sensor.moistPct + "%";
  document.getElementById("pvTemp").textContent  = sensor.tempC + "°C";
  document.getElementById("pvHum").textContent   = sensor.humPct + "%";

  // Decision preview (sementara pakai rule)
  const moistTh = Number(localStorage.getItem("gp_rule_moistTh") || 35);
  document.getElementById("pvNeed").textContent =
    sensor.moistPct < moistTh ? "Yes" : "No";

  document.getElementById("pvProb").textContent =
    sensor.moistPct < moistTh ? "High" : "Low";
});
</script>

  </body>
</html>
